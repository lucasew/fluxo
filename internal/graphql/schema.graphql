scalar Time

enum TorrentStatus {
    STOPPED
    DOWNLOADING_METADATA
    ALLOCATING
    VERIFYING
    DOWNLOADING
    SEEDING
    STOPPING
}

enum TrackerStatus {
    IDLE
    ANNOUNCING
    WAITING
    ERROR
}

enum PeerSource {
    TRACKER
    DHT
    PEX
    INCOMING
}

type Torrent {
    id: ID!
    name: String!
    infoHash: String!
    addedAt: Time!
    status: TorrentStatus!

    # Bytes (String para suportar >2^53)
    bytesCompleted: String!
    bytesTotal: String!
    bytesDownloaded: String!
    bytesUploaded: String!
    bytesMissing: String!

    # Speed (bytes/sec)
    downloadSpeed: Int!
    uploadSpeed: Int!

    # Time (seconds)
    eta: Int
    seedingTime: Int!
    downloadTime: Int!

    # Pieces
    piecesTotal: Int!
    piecesHave: Int!
    piecesAvailable: Int!
    pieceLength: Int!

    # Peers
    peers: PeerStats!

    # Collections
    files: [File!]!
    trackers: [Tracker!]!
    webseeds: [Webseed!]!

    # Metadata
    private: Boolean!

    # Error state
    error: String
}

type PeerStats {
    total: Int!
    incoming: Int!
    outgoing: Int!
}

type File {
    path: String!
    length: String!
    bytesCompleted: String!
    priority: Int!
}

type Tracker {
    url: String!
    status: TrackerStatus!
    leechers: Int
    seeders: Int
    error: String
    nextAnnounce: Time
    lastAnnounce: Time
}

type Webseed {
    url: String!
    downloadSpeed: Int!
    bytesDownloaded: String!
    error: String
}

type Peer {
    id: String!
    client: String!
    addr: String!
    source: PeerSource!
    connectedAt: Time!

    # State
    downloading: Boolean!
    clientInterested: Boolean!
    clientChoking: Boolean!
    peerInterested: Boolean!
    peerChoking: Boolean!
    optimisticUnchoked: Boolean!
    snubbed: Boolean!

    # Encryption
    encryptedHandshake: Boolean!
    encryptedStream: Boolean!

    # Speed
    downloadSpeed: Int!
    uploadSpeed: Int!
}

type SessionStats {
    uptime: Int!
    torrents: Int!
    peers: Int!
    portsAvailable: Int!
    blocklistRules: Int!
    blocklistRecency: Int!

    # Cache stats
    readCacheObjects: Int!
    readCacheSize: String!
    readCacheUtilization: Int!

    # Disk IO
    readsPerSecond: Int!
    readsActive: Int!
    readsPending: Int!

    # Write cache
    writeCacheObjects: Int!
    writeCacheSize: String!
    writeCachePendingKeys: Int!
}

input AddTorrentInput {
    uri: String
    torrentData: String
    stopped: Boolean
    stopAfterDownload: Boolean
    stopAfterMetadata: Boolean
}

type Query {
    torrents: [Torrent!]!
    torrent(id: ID!): Torrent
    sessionStats: SessionStats!
    torrentPeers(id: ID!): [Peer!]!
}

type Mutation {
    addTorrent(input: AddTorrentInput!): Torrent!
    removeTorrent(id: ID!): Boolean!

    startTorrent(id: ID!): Boolean!
    stopTorrent(id: ID!): Boolean!
    startAllTorrents: Boolean!
    stopAllTorrents: Boolean!

    verifyTorrent(id: ID!): Boolean!
    announceTorrent(id: ID!): Boolean!

    addTracker(id: ID!, url: String!): Boolean!
    addPeer(id: ID!, addr: String!): Boolean!
}

type Subscription {
    torrentAdded: Torrent!
    torrentRemoved: ID!
    torrentUpdated(id: ID): Torrent!
    statsUpdated: SessionStats!
}
